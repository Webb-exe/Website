---
import Layout from '../layouts/Layout.astro';
---

<Layout>
  <!-- Fixed Robot Background -->
  <div class="fixed inset-0 -z-10" id="robot-bg">
    <img src="/2e8c74a1-f585-4be5-a641-f0a44a202559.PNG" alt="359 Robot" id="hero-robot" class="w-full h-full object-cover object-center origin-center" />
    <!-- Dynamic overlay that changes with scroll -->
    <div class="absolute inset-0 bg-[#0a0a0a] pointer-events-none" id="bg-overlay" style="opacity: 0;"></div>
    <!-- Vignette -->
    <div class="absolute inset-0 pointer-events-none" style="background: radial-gradient(ellipse at center, transparent 30%, rgba(10,10,10,0.5) 100%);"></div>
  </div>

  <!-- Navigation -->
  <nav class="fixed top-0 left-0 right-0 z-50 px-6 py-5" id="main-nav">
    <div class="max-w-6xl mx-auto flex justify-between items-center">
      <a href="/" class="flex items-baseline gap-1 no-underline nav-logo">
        <span class="font-display text-2xl font-extrabold text-accent">359</span>
        <span class="font-serif-custom italic text-xl text-gray-500">.exe</span>
      </a>
      <div class="hidden md:flex gap-10">
        <a href="#about" class="nav-link text-gray-400 no-underline text-sm uppercase tracking-widest hover:text-white transition-colors">About</a>
        <a href="#team" class="nav-link text-gray-400 no-underline text-sm uppercase tracking-widest hover:text-white transition-colors">Team</a>
        <a href="#contact" class="nav-link text-gray-400 no-underline text-sm uppercase tracking-widest hover:text-white transition-colors">Contact</a>
      </div>
    </div>
  </nav>

  <!-- Floating Particles -->
  <div class="fixed inset-0 pointer-events-none z-40 overflow-hidden" id="particles">
    <div class="particle absolute w-1 h-1 bg-accent/30 rounded-full" style="left: 10%; top: 20%;"></div>
    <div class="particle absolute w-2 h-2 bg-accent/20 rounded-full" style="left: 80%; top: 30%;"></div>
    <div class="particle absolute w-1.5 h-1.5 bg-accent-light/20 rounded-full" style="left: 20%; top: 70%;"></div>
    <div class="particle absolute w-1 h-1 bg-accent/40 rounded-full" style="left: 70%; top: 80%;"></div>
    <div class="particle absolute w-2 h-2 bg-accent-light/15 rounded-full" style="left: 50%; top: 50%;"></div>
    <div class="particle absolute w-1 h-1 bg-accent/25 rounded-full" style="left: 30%; top: 40%;"></div>
  </div>

  <!-- SECTION 1: Hero - Full Robot View -->
  <section class="relative h-screen flex items-center justify-center" id="hero">
    <div class="text-center z-10 px-4 md:px-8 hero-content">
      <div class="hero-badge inline-block px-6 py-2.5 border border-[#9f6079]/40 rounded-full text-xs uppercase tracking-[0.15em] text-accent-light mb-8 backdrop-blur-md bg-[#9f6079]/20">
        <span class="text-accent-light">FTC Robotics Team</span> 
      </div>
      <h1 class="font-display font-extrabold leading-none flex flex-col items-center">
        <span class="hero-number text-white text-5xl sm:text-7xl md:text-8xl lg:text-[10rem] drop-shadow-2xl">359</span>
        <span class="text-accent-light text-3xl sm:text-4xl md:text-5xl lg:text-6xl mt-1" id="rotating-text-container">
          <span class="inline-block" id="rotating-text">Creators</span>
        </span>
      </h1>
      <p class="hero-tagline font-serif-custom italic text-xl sm:text-2xl md:text-3xl text-gray-400 mt-4 drop-shadow-lg">Webb.exe</p>
    </div>

    <!-- Decorative corner elements -->
    <div class="absolute top-20 left-8 w-16 h-16 border-l-2 border-t-2 border-accent/20 corner-decor"></div>
    <div class="absolute top-20 right-8 w-16 h-16 border-r-2 border-t-2 border-accent/20 corner-decor"></div>
    <div class="absolute bottom-32 left-8 w-16 h-16 border-l-2 border-b-2 border-accent/20 corner-decor"></div>
    <div class="absolute bottom-32 right-8 w-16 h-16 border-r-2 border-b-2 border-accent/20 corner-decor"></div>

    <div class="absolute bottom-12 left-1/2 -translate-x-1/2 flex flex-col items-center gap-3 scroll-indicator">
      <span class="text-[0.7rem] uppercase tracking-[0.2em] text-gray-400">Scroll</span>
      <div class="scroll-line w-px h-16 bg-gradient-to-b from-[#9f6079] to-transparent"></div>
    </div>
  </section>

  <!-- SECTION 2: Reveal Moment - Robot Gets Revealed -->
  <section class="relative h-screen flex items-center justify-center" id="reveal">
    <!-- Floating text that appears during reveal -->
    <div class="text-center" id="reveal-text">
      <span class="font-display text-6xl sm:text-8xl md:text-9xl font-extrabold text-white/5 tracking-tight">EXCELLENCE</span>
    </div>
  </section>

  <!-- Transition Section - Spacer -->
  <section class="relative h-[20vh]" id="transition-section">
    <div class="absolute inset-0 bg-gradient-to-b from-transparent to-[#0a0a0a]"></div>
  </section>

  <!-- SECTION 3: About - Slides up over the robot -->
  <section class="relative min-h-screen" id="about">
    <!-- Curved top edge -->
    <div class="absolute -top-24 left-0 right-0 h-32 bg-gradient-to-b from-transparent via-[#0a0a0a]/50 to-[#0a0a0a]" id="about-curve"></div>
    
    <div class="bg-[#0a0a0a] py-20 px-6 min-h-screen flex items-center">
      <div class="max-w-6xl mx-auto w-full">
        <div class="mb-16" id="about-header">
          <div class="flex items-center gap-4 mb-6">
            <div class="w-16 h-px bg-gradient-to-r from-accent to-transparent" id="about-line"></div>
            <span class="font-display text-xs text-accent uppercase tracking-[0.3em]" id="about-label">About Us</span>
          </div>
          <h2 class="font-display text-4xl sm:text-5xl md:text-7xl font-bold leading-tight overflow-hidden">
            <span class="inline-block" id="about-title-1">Who We</span> <span class="text-accent-light inline-block" id="about-title-2">Are</span>
          </h2>
        </div>
        
        <div class="grid md:grid-cols-2 gap-12 md:gap-20">
          <div id="about-text">
            <p class="font-serif-custom text-xl sm:text-2xl leading-relaxed mb-6 text-gray-200">
              We are <em class="text-accent-light italic">359 Webb.exe</em>, a competitive FIRST Robotics team dedicated to engineering excellence.
            </p>
            <p class="text-gray-500 leading-relaxed text-lg">
              Founded with the mission to create, innovate, and solve complex engineering challenges, our team brings together diverse talents united by a passion for robotics and technology.
            </p>
          </div>
          
          <div class="grid grid-cols-3 gap-4" id="stats-grid">
            <div class="stat-card text-center p-6 rounded-2xl bg-white/[0.02] border border-white/5 hover:border-accent/30 transition-colors">
              <span class="font-display text-4xl md:text-5xl font-extrabold text-accent-light block" data-count="15">0</span>
              <span class="text-xs text-gray-500 uppercase tracking-wider mt-2 block">Years</span>
            </div>
            <div class="stat-card text-center p-6 rounded-2xl bg-white/[0.02] border border-white/5 hover:border-accent/30 transition-colors">
              <span class="font-display text-4xl md:text-5xl font-extrabold text-accent-light block" data-count="50">0</span>
              <span class="text-xs text-gray-500 uppercase tracking-wider mt-2 block">Members</span>
            </div>
            <div class="stat-card text-center p-6 rounded-2xl bg-white/[0.02] border border-white/5 hover:border-accent/30 transition-colors">
              <span class="font-display text-4xl md:text-5xl font-extrabold text-accent-light block" data-count="20">0</span>
              <span class="text-xs text-gray-500 uppercase tracking-wider mt-2 block">Awards</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SECTION 4: Values - Creative Cards -->
  <section class="relative min-h-screen px-6 overflow-hidden flex items-center" id="values">
    <div class="absolute inset-0 bg-gradient-to-b from-[#0a0a0a] via-[#0d0d0d] to-[#0a0a0a]"></div>
    
    <!-- Decorative elements -->
    <div class="values-glow absolute top-1/2 left-0 w-96 h-96 bg-accent/5 rounded-full blur-[120px] -translate-x-1/2 -translate-y-1/2"></div>
    <div class="values-glow absolute top-1/3 right-0 w-64 h-64 bg-accent/5 rounded-full blur-[100px] translate-x-1/2"></div>
    
    <!-- Grid pattern overlay -->
    <div class="absolute inset-0 opacity-[0.02]" style="background-image: linear-gradient(rgba(159,96,121,0.5) 1px, transparent 1px), linear-gradient(90deg, rgba(159,96,121,0.5) 1px, transparent 1px); background-size: 50px 50px;" id="values-grid"></div>
    
    <div class="max-w-6xl mx-auto relative z-10 w-full py-20">
      <div class="text-center mb-20" id="values-header">
        <h2 class="font-display text-3xl sm:text-4xl md:text-5xl font-bold">
          What Drives Us
        </h2>
      </div>
      
      <div class="grid md:grid-cols-3 gap-8" id="values-cards">
        <div class="value-card group">
          <div class="card-inner relative p-8 md:p-10 rounded-3xl bg-gradient-to-br from-white/[0.03] to-transparent border border-white/5 hover:border-accent/30 transition-all duration-500 hover:-translate-y-2">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-accent via-accent-light to-transparent rounded-t-3xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
            <div class="card-icon w-14 h-14 mb-8 rounded-2xl bg-accent/10 flex items-center justify-center text-accent">
              <svg class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
              </svg>
            </div>
            <h3 class="font-display text-2xl font-semibold mb-4">Create</h3>
            <p class="text-gray-500 leading-relaxed">Transform ideas into reality through innovative engineering and design.</p>
          </div>
        </div>
        
        <div class="value-card group">
          <div class="card-inner relative p-8 md:p-10 rounded-3xl bg-gradient-to-br from-white/[0.03] to-transparent border border-white/5 hover:border-accent/30 transition-all duration-500 hover:-translate-y-2 md:mt-12">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-accent via-accent-light to-transparent rounded-t-3xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
            <div class="card-icon w-14 h-14 mb-8 rounded-2xl bg-accent/10 flex items-center justify-center text-accent">
              <svg class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 6v6l4 2"/>
              </svg>
            </div>
            <h3 class="font-display text-2xl font-semibold mb-4">Innovate</h3>
            <p class="text-gray-500 leading-relaxed">Push boundaries and explore new technologies to stay ahead.</p>
          </div>
        </div>
        
        <div class="value-card group">
          <div class="card-inner relative p-8 md:p-10 rounded-3xl bg-gradient-to-br from-white/[0.03] to-transparent border border-white/5 hover:border-accent/30 transition-all duration-500 hover:-translate-y-2">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-accent via-accent-light to-transparent rounded-t-3xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
            <div class="card-icon w-14 h-14 mb-8 rounded-2xl bg-accent/10 flex items-center justify-center text-accent">
              <svg class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
              </svg>
            </div>
            <h3 class="font-display text-2xl font-semibold mb-4">Solve</h3>
            <p class="text-gray-500 leading-relaxed">Every challenge is an opportunity to learn and overcome obstacles.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SECTION 5: Team -->
  <section class="relative min-h-screen px-6 bg-[#0a0a0a] flex items-center" id="team">
    <div class="max-w-6xl mx-auto w-full py-20">
      <div class="grid md:grid-cols-2 gap-16 items-center">
        <div id="team-content">
          <div class="flex items-center gap-4 mb-6">
            <div class="w-16 h-px bg-gradient-to-r from-accent to-transparent" id="team-line"></div>
            <span class="font-display text-xs text-accent uppercase tracking-[0.3em]" id="team-label">Our Team</span>
          </div>
          <h2 class="font-display text-4xl sm:text-5xl md:text-6xl font-bold leading-tight mb-8 overflow-hidden">
            <span class="inline-block" id="team-title-1">The People Behind</span> <span class="text-accent-light inline-block" id="team-title-2">the Bot</span>
          </h2>
          <p class="font-serif-custom text-xl leading-relaxed text-gray-400 mb-8" id="team-desc">
            A diverse group of students, mentors, and sponsors working together to build more than robots—we build futures.
          </p>
        </div>
        
        <div id="team-tags">
          <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
            <div class="dept-tag group px-4 py-5 rounded-xl bg-white/[0.02] border border-white/5 hover:bg-accent/10 hover:border-accent/30 transition-all duration-300 text-center">
              <span class="text-sm font-medium text-gray-400 group-hover:text-white transition-colors">Mechanical</span>
            </div>
            <div class="dept-tag group px-4 py-5 rounded-xl bg-white/[0.02] border border-white/5 hover:bg-accent/10 hover:border-accent/30 transition-all duration-300 text-center">
              <span class="text-sm font-medium text-gray-400 group-hover:text-white transition-colors">Electrical</span>
            </div>
            <div class="dept-tag group px-4 py-5 rounded-xl bg-white/[0.02] border border-white/5 hover:bg-accent/10 hover:border-accent/30 transition-all duration-300 text-center">
              <span class="text-sm font-medium text-gray-400 group-hover:text-white transition-colors">Programming</span>
            </div>
            <div class="dept-tag group px-4 py-5 rounded-xl bg-white/[0.02] border border-white/5 hover:bg-accent/10 hover:border-accent/30 transition-all duration-300 text-center">
              <span class="text-sm font-medium text-gray-400 group-hover:text-white transition-colors">Design</span>
            </div>
            <div class="dept-tag group px-4 py-5 rounded-xl bg-white/[0.02] border border-white/5 hover:bg-accent/10 hover:border-accent/30 transition-all duration-300 text-center">
              <span class="text-sm font-medium text-gray-400 group-hover:text-white transition-colors">Business</span>
            </div>
            <div class="dept-tag group px-4 py-5 rounded-xl bg-white/[0.02] border border-white/5 hover:bg-accent/10 hover:border-accent/30 transition-all duration-300 text-center">
              <span class="text-sm font-medium text-gray-400 group-hover:text-white transition-colors">Media</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SECTION 6: Contact - Big CTA -->
  <section class="relative min-h-screen px-6 overflow-hidden flex items-center" id="contact">
    <div class="absolute inset-0 bg-gradient-to-b from-[#0a0a0a] via-[#0f0a0c] to-[#0a0a0a]"></div>
    
    <!-- Decorative glow -->
    <div class="absolute bottom-1/4 left-1/2 -translate-x-1/2 w-[600px] h-[400px] bg-accent/10 rounded-full blur-[150px]"></div>
    
    <div class="max-w-4xl mx-auto text-center relative z-10 w-full py-20" id="contact-content">
      <span class="font-display text-xs text-accent uppercase tracking-[0.3em] block mb-6" id="contact-label">Get Involved</span>
      <h2 class="font-display text-4xl sm:text-5xl md:text-7xl lg:text-8xl font-extrabold mb-6 overflow-hidden">
        <span class="inline-block" id="contact-title-1">Join the</span><br/><span class="text-accent-light inline-block" id="contact-title-2">Mission</span>
      </h2>
      <p class="text-gray-500 text-lg md:text-xl max-w-xl mx-auto mb-12" id="contact-desc">
        Interested in sponsoring, mentoring, or joining our team? Let's build the future together.
      </p>
      
      <a href="mailto:team@359webb.exe" id="contact-btn" class="group inline-flex items-center gap-3 px-10 py-5 text-base font-medium uppercase tracking-widest bg-accent text-white rounded-full hover:bg-accent-light hover:text-[#0a0a0a] transition-all duration-300 hover:scale-105">
        Get in Touch
        <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </a>
    </div>
  </section>

  <!-- Footer -->
  <footer class="py-16 px-6 bg-[#080808] border-t border-white/5">
    <div class="max-w-6xl mx-auto">
      <div class="flex flex-col md:flex-row justify-between items-center gap-8">
        <div class="flex items-baseline gap-1">
          <span class="font-display text-3xl font-extrabold text-accent">359</span>
          <span class="font-serif-custom italic text-2xl text-gray-600">.exe</span>
        </div>
        
        <p class="text-gray-600 text-sm">Creators · Innovators · Solvers</p>
        
        <div class="flex gap-5">
          <a href="#" aria-label="Instagram" class="w-5 h-5 text-gray-600 hover:text-accent-light transition-colors">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="2" y="2" width="20" height="20" rx="5"/>
              <circle cx="12" cy="12" r="4"/>
              <circle cx="18" cy="6" r="1"/>
            </svg>
          </a>
          <a href="#" aria-label="Twitter" class="w-5 h-5 text-gray-600 hover:text-accent-light transition-colors">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"/>
            </svg>
          </a>
          <a href="#" aria-label="GitHub" class="w-5 h-5 text-gray-600 hover:text-accent-light transition-colors">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
            </svg>
          </a>
        </div>
      </div>
      
      <div class="mt-12 pt-8 border-t border-white/5 text-center">
        <p class="text-gray-700 text-xs">© 2024 Team 359 Webb.exe. All rights reserved.</p>
      </div>
    </div>
  </footer>
</Layout>

<style>
  /* Hero content - GSAP handles animations */
  .hero-content {
    will-change: transform, opacity, filter;
    perspective: 1000px;
  }
  
  /* Scroll indicator */
  .scroll-indicator {
    will-change: opacity, transform;
  }
  
  /* Background image */
  #hero-robot {
    will-change: transform, filter;
  }
  
  #bg-overlay {
    will-change: opacity;
  }

  /* Navigation scrolled state */
  #main-nav {
    transition: background-color 0.3s ease, backdrop-filter 0.3s ease, box-shadow 0.3s ease;
  }
  
  #main-nav.nav-scrolled {
    background-color: rgba(10, 10, 10, 0.8);
    backdrop-filter: blur(20px);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
  }

  /* Particles */
  .particle {
    will-change: transform, opacity;
  }

  /* 3D perspective for cards */
  .value-card,
  .stat-card {
    perspective: 1000px;
    transform-style: preserve-3d;
  }

  /* Smooth transitions for interactive elements */
  .card-inner {
    transform-style: preserve-3d;
    backface-visibility: hidden;
  }

  /* Corner decorations */
  .corner-decor {
    will-change: transform, opacity;
  }

  /* Reveal text */
  #reveal-text {
    will-change: transform, opacity;
    text-shadow: 0 0 100px rgba(159, 96, 121, 0.3);
  }

  /* Transition line glow */
  #transition-line {
    box-shadow: 0 0 20px rgba(159, 96, 121, 0.5);
  }

  /* Department tags hover effect enhancement */
  .dept-tag {
    transform-style: preserve-3d;
  }

  /* Values grid pattern */
  #values-grid {
    will-change: opacity;
  }

  /* Glow elements */
  .values-glow {
    will-change: transform, opacity;
  }

  /* Contact button glow on hover */
  #contact-btn {
    box-shadow: 0 0 0 rgba(159, 96, 121, 0);
    transition: box-shadow 0.3s ease;
  }
  
  #contact-btn:hover {
    box-shadow: 0 0 40px rgba(159, 96, 121, 0.4);
  }

  /* Title text 3D effect */
  #about-title-1, #about-title-2,
  #team-title-1, #team-title-2,
  #contact-title-1, #contact-title-2 {
    transform-style: preserve-3d;
    will-change: transform, opacity;
  }

  /* Rotating text 3D effect */
  #rotating-text {
    display: inline-block;
    transform-style: preserve-3d;
    backface-visibility: hidden;
    will-change: transform, opacity, filter;
  }
  
  /* Parent needs perspective for 3D rotation */
  #rotating-text-container {
    perspective: 500px;
  }
</style>

<script>
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';
  import Snap from 'lenis/snap';
  import type Lenis from 'lenis';

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener('DOMContentLoaded', () => {
    // Get global Lenis instance from Layout.astro
    const lenis = (window as any).lenis as Lenis;
    
    // Wait for Lenis to be available
    if (!lenis) {
      console.warn('Lenis not found on window');
      return;
    }

    // ============================================
    // LENIS SNAP SETUP - Content Sections Only
    // ============================================
    let snap: Snap | null = null;
    let snapEnabled = false;

    // Function to calculate and add snap points after ScrollTrigger is set up
    function setupSnapPoints() {
      if (!snap) return;
      
      // Snap to hero section (title) at the start
      const heroSection = document.getElementById('hero');
      if (heroSection) {
        snap.addElement(heroSection, { align: 'start' });
      }
      
      // Handle #reveal specially - snap when EXCELLENCE is fully visible (not at end)
      const revealTrigger = ScrollTrigger.getAll().find(st => st.vars.trigger === '#reveal' && st.pin);
      if (revealTrigger && snap) {
        // The reveal timeline: fade in (1) + hold (0.5) + fade out (1) = 2.5 total
        // Snap at progress ~0.4 (after fade in, during hold) = 40% through the pin
        const revealStart = revealTrigger.start;
        const revealDuration = revealTrigger.end - revealTrigger.start;
        const snapAtWritten = revealStart + (revealDuration * 0.4);
        snap.add(snapAtWritten);
      }
      
      // Other sections snap at the END of their animations
      const pinnedSections = ['#about', '#values', '#team', '#contact'];
      
      pinnedSections.forEach((selector) => {
        const trigger = ScrollTrigger.getAll().find(st => st.vars.trigger === selector && st.pin);
        if (trigger && snap) {
          // Snap at the end of the pin (when animation completes)
          const endPosition = trigger.end;
          snap.add(endPosition);
        }
      });
    }

    // Initialize snap immediately (including title)
    function initializeSnap() {
      if (!snap) {
        snap = new Snap(lenis, {
          type: 'mandatory',
          debounce: 150,
        });
        setupSnapPoints();
        snapEnabled = true;
      }
    }
    // ============================================
    // INITIAL PAGE LOAD ANIMATION
    // ============================================
    const loadTl = gsap.timeline();
    
    // Animate nav in
    loadTl.fromTo('.nav-logo', 
      { opacity: 0, x: -30 },
      { opacity: 1, x: 0, duration: 0.8, ease: 'power3.out' }
    );
    loadTl.fromTo('.nav-link',
      { opacity: 0, y: -20 },
      { opacity: 1, y: 0, duration: 0.5, stagger: 0.1, ease: 'power2.out' },
      '-=0.5'
    );
    
    // Hero content entrance
    loadTl.fromTo('.hero-badge',
      { opacity: 0, y: 30, scale: 0.8 },
      { opacity: 1, y: 0, scale: 1, duration: 0.6, ease: 'back.out(1.7)' },
      '-=0.3'
    );
    loadTl.fromTo('.hero-number',
      { opacity: 0, scale: 0.5, rotationX: -45 },
      { opacity: 1, scale: 1, rotationX: 0, duration: 0.8, ease: 'power3.out' },
      '-=0.4'
    );
    loadTl.fromTo('#rotating-text',
      { opacity: 0, y: 30 },
      { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out' },
      '-=0.5'
    );
    loadTl.fromTo('.hero-tagline',
      { opacity: 0, y: 20 },
      { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out' },
      '-=0.3'
    );
    
    // Corner decorations
    loadTl.fromTo('.corner-decor',
      { opacity: 0, scale: 0 },
      { opacity: 1, scale: 1, duration: 0.6, stagger: 0.1, ease: 'back.out(1.7)' },
      '-=0.4'
    );
    
    // Scroll indicator
    loadTl.fromTo('.scroll-indicator',
      { opacity: 0, y: 20 },
      { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out' },
      '-=0.3'
    );
    
    // Scroll line animation (continuous)
    gsap.fromTo('.scroll-line',
      { scaleY: 0, transformOrigin: 'top' },
      { scaleY: 1, duration: 1, ease: 'power2.out', repeat: -1, yoyo: true }
    );

    // ============================================
    // ROTATING TEXT ANIMATION
    // ============================================
    const words = ['Creators', 'Innovators', 'Solvers', 'Engineers', 'Dreamers'];
    let currentIndex = 0;
    const rotatingText = document.getElementById('rotating-text');

    function rotateText() {
      if (!rotatingText) return;
      
      // Old text rotates out (rotates upward/backward)
      gsap.to(rotatingText, {
        rotationX: -90,
        opacity: 0,
        y: -20,
        filter: 'blur(4px)',
        duration: 0.4,
        ease: 'power2.in',
        onComplete: () => {
          currentIndex = (currentIndex + 1) % words.length;
          rotatingText.textContent = words[currentIndex];
          
          // New text rotates in (rotates from below/forward)
          gsap.fromTo(rotatingText, 
            { rotationX: 90, opacity: 0, y: 20, filter: 'blur(4px)' },
            { rotationX: 0, opacity: 1, y: 0, filter: 'blur(0px)', duration: 0.4, ease: 'power2.out' }
          );
        }
      });
    }
    setInterval(rotateText, 1500);

    // ============================================
    // FLOATING PARTICLES
    // ============================================
    const particles = gsap.utils.toArray('.particle') as HTMLElement[];
    particles.forEach((particle, i) => {
      gsap.to(particle, {
        y: `random(-100, 100)`,
        x: `random(-50, 50)`,
        opacity: `random(0.1, 0.5)`,
        duration: `random(3, 6)`,
        repeat: -1,
        yoyo: true,
        ease: 'sine.inOut',
        delay: i * 0.3
      });
    });

    // ============================================
    // HERO SECTION - SCRUB TIMELINE (plays both ways)
    // ============================================
    const heroRobot = document.getElementById('hero-robot');
    const bgOverlay = document.getElementById('bg-overlay');
    const heroContent = document.querySelector('.hero-content') as HTMLElement;
    const scrollIndicator = document.querySelector('.scroll-indicator') as HTMLElement;

    // Hero parallax timeline - scrub means it plays both ways
    const heroTl = gsap.timeline({
      scrollTrigger: {
        trigger: '#hero',
        start: 'top top',
        end: 'bottom top',
        scrub: 1,
      }
    });

    if (heroContent) {
      heroTl
        .fromTo(heroContent, 
          { y: 0, opacity: 1, scale: 1, filter: 'blur(0px)' },
          { y: -150, opacity: 0, scale: 0.85, filter: 'blur(10px)', duration: 1 }, 0)
        .fromTo(scrollIndicator, 
          { opacity: 1, y: 0 },
          { opacity: 0, y: 50, duration: 0.5 }, 0)
        .fromTo('.corner-decor', 
          { opacity: 1, scale: 1 },
          { opacity: 0, scale: 0.5, duration: 0.5, stagger: 0.05 }, 0)
        .fromTo('.particle', 
          { opacity: 1 },
          { opacity: 0, duration: 0.5 }, 0);
    }

    // ============================================
    // REVEAL SECTION - SCRUB PINNED
    // ============================================
    const revealTextTl = gsap.timeline({
      scrollTrigger: {
        trigger: '#reveal',
        start: 'top top',
        end: '+=200%',
        pin: true,
        scrub: 0.5,
      }
    });

    revealTextTl
      .fromTo('#reveal-text',
        { opacity: 0, scale: 0.5, y: 100, filter: 'blur(20px)' },
        { opacity: 1, scale: 1, y: 0, filter: 'blur(0px)', duration: 1 }
      )
      .to('#reveal-text', { duration: 0.5 }) // Hold
      .to('#reveal-text',
        { opacity: 0, scale: 1.5, y: -100, filter: 'blur(20px)', duration: 1 }
      );

    // Robot cinematic reveal - smooth scrub (plays both ways)
    if (heroRobot && bgOverlay) {
      const robotTl = gsap.timeline({
        scrollTrigger: {
          trigger: '#hero',
          start: 'top top',
          endTrigger: '#about',
          end: 'top 30%',
          scrub: 1.5,
        }
      });

      robotTl
        .to(heroRobot, { scale: 1.05, duration: 0.5, ease: 'none' }, 0)
        .to(heroRobot, { scale: 1.12, filter: 'blur(3px)', duration: 1, ease: 'power1.in' }, 0.5)
        .to(bgOverlay, { opacity: 0.3, duration: 1 }, 0.5)
        .to(heroRobot, { scale: 1.2, filter: 'blur(8px)', duration: 1, ease: 'power1.in' }, 1.5)
        .to(bgOverlay, { opacity: 0.6, duration: 1 }, 1.5)
        .to(heroRobot, { scale: 1.35, filter: 'blur(20px)', duration: 1.5, ease: 'power2.in' }, 2.5)
        .to(bgOverlay, { opacity: 1, duration: 1.5 }, 2.5);
    }

    // ============================================
    // ABOUT SECTION TIMELINE - SCRUB PINNED
    // ============================================
    const aboutTl = gsap.timeline({
      scrollTrigger: {
        trigger: '#about',
        start: 'top top',
        end: '+=150%',
        pin: true,
        scrub: 0.5,
      }
    });

    // Line draws in
    aboutTl.fromTo('#about-line', 
      { width: 0, opacity: 0 },
      { width: '4rem', opacity: 1, duration: 0.3 }
    );
    
    // Label fades in
    aboutTl.fromTo('#about-label',
      { opacity: 0, x: -30 },
      { opacity: 1, x: 0, duration: 0.2 },
      '-=0.1'
    );

    // Title words slide up
    aboutTl.fromTo('#about-title-1',
      { y: 80, opacity: 0 },
      { y: 0, opacity: 1, duration: 0.3 },
      '-=0.1'
    );
    aboutTl.fromTo('#about-title-2',
      { y: 80, opacity: 0, scale: 1.2 },
      { y: 0, opacity: 1, scale: 1, duration: 0.3 },
      '-=0.2'
    );

    // Text content fades in
    aboutTl.fromTo('#about-text',
      { opacity: 0, x: -60 },
      { opacity: 1, x: 0, duration: 0.3 },
      '-=0.1'
    );

    // Stats cards
    const statCards = gsap.utils.toArray('.stat-card') as HTMLElement[];
    aboutTl.fromTo(statCards,
      { opacity: 0, y: 40, scale: 0.8 },
      { 
        opacity: 1, 
        y: 0, 
        scale: 1,
        duration: 0.3, 
        stagger: 0.1,
      },
      '-=0.1'
    );
    
    // Hold at end so content stays visible
    aboutTl.to({}, { duration: 0.5 });

    // Counter animation for stats (only once)
    statCards.forEach((card) => {
      const countEl = card.querySelector('[data-count]') as HTMLElement;
      if (countEl) {
        const target = parseInt(countEl.dataset.count || '0');
        let hasAnimated = false;
        ScrollTrigger.create({
          trigger: card,
          start: 'top 85%',
          onEnter: () => {
            if (!hasAnimated) {
              hasAnimated = true;
              gsap.to({ val: 0 }, {
                val: target,
                duration: 2,
                ease: 'power2.out',
                onUpdate: function() {
                  countEl.textContent = Math.round(this.targets()[0].val) + '+';
                }
              });
            }
          }
        });
      }
    });

    // ============================================
    // VALUES SECTION TIMELINE - SCRUB PINNED
    // ============================================
    const valuesTl = gsap.timeline({
      scrollTrigger: {
        trigger: '#values',
        start: 'top top',
        end: '+=150%',
        pin: true,
        scrub: 0.5,
      }
    });

    // Grid pattern fades in
    valuesTl.fromTo('#values-grid',
      { opacity: 0 },
      { opacity: 0.02, duration: 0.2 }
    );

    // Glows pulse in
    valuesTl.fromTo('.values-glow',
      { opacity: 0, scale: 0.5 },
      { opacity: 1, scale: 1, duration: 0.3, stagger: 0.1 },
      '-=0.1'
    );

    // Header scales in
    valuesTl.fromTo('#values-header',
      { opacity: 0, scale: 0.8, y: 40 },
      { opacity: 1, scale: 1, y: 0, duration: 0.3 },
      '-=0.1'
    );

    // Cards fan in from different directions
    const valueCards = gsap.utils.toArray('.value-card') as HTMLElement[];
    valueCards.forEach((card, i) => {
      const xOffset = i === 0 ? -100 : i === 2 ? 100 : 0;
      const yOffset = i === 1 ? 60 : 50;
      
      valuesTl.fromTo(card,
        { opacity: 0, x: xOffset, y: yOffset, scale: 0.8 },
        { opacity: 1, x: 0, y: 0, scale: 1, duration: 0.3 },
        i === 0 ? '-=0.1' : '-=0.2'
      );
    });

    // Icons spin in
    const cardIcons = gsap.utils.toArray('.card-icon') as HTMLElement[];
    valuesTl.fromTo(cardIcons,
      { rotation: -180, scale: 0, opacity: 0 },
      { rotation: 0, scale: 1, opacity: 1, duration: 0.3, stagger: 0.08 },
      '-=0.2'
    );
    
    // Hold at end
    valuesTl.to({}, { duration: 0.5 });

    // ============================================
    // TEAM SECTION TIMELINE - SCRUB PINNED
    // ============================================
    const teamTl = gsap.timeline({
      scrollTrigger: {
        trigger: '#team',
        start: 'top top',
        end: '+=150%',
        pin: true,
        scrub: 0.5,
      }
    });

    // Line draws
    teamTl.fromTo('#team-line',
      { width: 0, opacity: 0 },
      { width: '4rem', opacity: 1, duration: 0.3 }
    );

    // Label
    teamTl.fromTo('#team-label',
      { opacity: 0, x: -20 },
      { opacity: 1, x: 0, duration: 0.2 },
      '-=0.1'
    );

    // Title words
    teamTl.fromTo('#team-title-1',
      { y: 60, opacity: 0 },
      { y: 0, opacity: 1, duration: 0.3 },
      '-=0.1'
    );
    teamTl.fromTo('#team-title-2',
      { y: 60, opacity: 0, scale: 1.2 },
      { y: 0, opacity: 1, scale: 1, duration: 0.3 },
      '-=0.2'
    );

    // Description
    teamTl.fromTo('#team-desc',
      { opacity: 0, y: 30 },
      { opacity: 1, y: 0, duration: 0.3 },
      '-=0.1'
    );

    // Department tags
    const deptTags = gsap.utils.toArray('.dept-tag') as HTMLElement[];
    teamTl.fromTo(deptTags,
      { opacity: 0, scale: 0, y: 20 },
      { 
        opacity: 1, 
        scale: 1, 
        y: 0,
        duration: 0.2, 
        stagger: 0.05,
      },
      '-=0.1'
    );
    
    // Hold at end
    teamTl.to({}, { duration: 0.5 });

    // ============================================
    // CONTACT SECTION TIMELINE - SCRUB PINNED
    // ============================================
    const contactTl = gsap.timeline({
      scrollTrigger: {
        trigger: '#contact',
        start: 'top top',
        end: '+=150%',
        pin: true,
        scrub: 0.5,
      }
    });

    // Label drops in
    contactTl.fromTo('#contact-label',
      { opacity: 0, y: -30 },
      { opacity: 1, y: 0, duration: 0.3 }
    );

    // Title lines
    contactTl.fromTo('#contact-title-1',
      { opacity: 0, scale: 0.5, y: 50 },
      { opacity: 1, scale: 1, y: 0, duration: 0.3 },
      '-=0.1'
    );
    contactTl.fromTo('#contact-title-2',
      { opacity: 0, scale: 1.5, y: -30 },
      { opacity: 1, scale: 1, y: 0, duration: 0.3 },
      '-=0.2'
    );

    // Description
    contactTl.fromTo('#contact-desc',
      { opacity: 0, y: 30 },
      { opacity: 1, y: 0, duration: 0.3 },
      '-=0.1'
    );

    // Button
    contactTl.fromTo('#contact-btn',
      { opacity: 0, scale: 0.5, y: 20 },
      { opacity: 1, scale: 1, y: 0, duration: 0.3 },
      '-=0.1'
    );
    
    // Hold at end
    contactTl.to({}, { duration: 0.5 });

    // Glow pulse animation (continuous)
    gsap.to('#contact .bg-accent\\/10', {
      scale: 1.2,
      opacity: 0.2,
      duration: 3,
      repeat: -1,
      yoyo: true,
      ease: 'sine.inOut'
    });

    // ============================================
    // FOOTER TIMELINE - REPLAYABLE
    // ============================================
    const footerTl = gsap.timeline({
      scrollTrigger: {
        trigger: 'footer',
        start: 'top 90%',
        end: 'bottom bottom',
        toggleActions: 'play reverse play reverse',
      }
    });

    footerTl.fromTo('footer .flex-col',
      { opacity: 0, y: 50 },
      { opacity: 1, y: 0, duration: 0.8, ease: 'power2.out' }
    );

    footerTl.fromTo('footer .mt-12',
      { opacity: 0, scaleX: 0 },
      { opacity: 1, scaleX: 1, duration: 0.6, ease: 'power2.out' },
      '-=0.4'
    );

    // ============================================
    // GLOBAL PARALLAX EFFECTS
    // ============================================
    
    // Navigation background on scroll
    ScrollTrigger.create({
      start: 'top -80',
      end: 99999,
      toggleClass: { className: 'nav-scrolled', targets: '#main-nav' }
    });

    // Refresh after all setup
    ScrollTrigger.refresh();

    // Initialize snap after ScrollTrigger is ready
    setTimeout(() => {
      initializeSnap();
    }, 100);
  });
</script>
